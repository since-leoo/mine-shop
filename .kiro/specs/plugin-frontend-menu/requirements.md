# 需求文档

## 简介

插件前端菜单管理功能是为 MineAdmin 平台设计的插件菜单管理方案。该功能允许插件在前端定义菜单结构，系统自动将插件菜单合并到导航栏中，无需在插件安装/卸载时操作数据库菜单表。这简化了插件的安装卸载流程，提高了插件的可移植性和维护性。

## 术语表

- **插件菜单（Plugin_Menu）**: 插件在前端配置文件中定义的菜单结构
- **菜单合并器（Menu_Merger）**: 负责将插件菜单与后端菜单合并的前端服务
- **路由存储（Route_Store）**: 管理路由和菜单数据的 Pinia 存储
- **菜单存储（Menu_Store）**: 管理导航菜单显示的 Pinia 存储
- **插件配置（Plugin_Config）**: 插件的前端配置对象，包含 views、menus 等配置
- **权限验证（Permission_Check）**: 基于用户权限过滤菜单显示的机制

## 需求

### 需求 1：插件菜单定义

**用户故事：** 作为插件开发者，我希望能够在前端配置文件中定义插件的菜单结构，以便插件菜单能够自动出现在系统导航栏中。

#### 验收标准

1. 当定义插件配置时，插件配置应支持 `menus` 属性来定义菜单结构
2. 当定义菜单时，菜单定义应支持多级嵌套结构（父菜单和子菜单）
3. 当定义菜单时，菜单定义应支持完整的菜单元数据（标题、图标、路径、权限等）
4. 当定义菜单时，菜单定义应支持国际化配置（i18n）
5. 插件菜单定义应与现有的 `views` 路由配置保持一致性

### 需求 2：菜单自动合并

**用户故事：** 作为系统用户，我希望插件菜单能够自动出现在导航栏中，以便无需手动配置即可使用插件功能。

#### 验收标准

1. 当系统初始化时，菜单合并器应自动收集所有启用插件的菜单定义
2. 当合并菜单时，菜单合并器应将插件菜单与后端返回的菜单合并
3. 当合并菜单时，菜单合并器应根据插件配置的 `order` 属性排序菜单
4. 当插件被禁用时，菜单合并器应自动从导航栏移除该插件的菜单
5. 菜单合并器应支持插件菜单插入到指定位置（顶级或作为某个菜单的子菜单）

### 需求 3：权限控制

**用户故事：** 作为系统管理员，我希望插件菜单能够根据用户权限显示或隐藏，以便保持系统的安全性。

#### 验收标准

1. 当渲染菜单时，系统应根据菜单的 `auth` 配置验证用户权限
2. 当用户无权限时，系统应隐藏对应的菜单项
3. 当验证权限时，系统应支持多种权限验证方式（权限码、角色、用户）
4. 权限验证应与后端权限系统保持一致

### 需求 4：路由与菜单同步

**用户故事：** 作为插件开发者，我希望菜单定义能够自动关联对应的路由，以便减少重复配置。

#### 验收标准

1. 当定义菜单时，菜单应能够引用 `views` 中定义的路由组件
2. 当菜单被点击时，系统应正确导航到对应的路由
3. 当路由变化时，系统应正确高亮对应的菜单项
4. 系统应支持菜单和路由的分离定义（菜单可以不对应路由，如外链）

### 需求 5：简化安装卸载流程

**用户故事：** 作为系统管理员，我希望插件安装卸载时不需要操作菜单数据，以便简化插件管理流程。

#### 验收标准

1. 当插件安装时，安装脚本不应操作数据库菜单表
2. 当插件卸载时，卸载脚本不应操作数据库菜单表
3. 当插件启用/禁用时，菜单应自动出现/消失
4. 系统应保持向后兼容，支持后端定义的菜单继续工作

### 需求 6：开发体验优化

**用户故事：** 作为插件开发者，我希望有清晰的菜单配置方式和类型提示，以便快速开发插件。

#### 验收标准

1. 插件配置应提供完整的 TypeScript 类型定义
2. 菜单配置应支持与 MineAdmin 现有菜单结构兼容的格式
3. 系统应在开发模式下提供菜单配置错误提示
4. 文档应提供清晰的菜单配置示例
