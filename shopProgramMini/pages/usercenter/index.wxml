<view class="page-container">
  <!-- 顶部用户卡片 -->
  <t-user-center-card
    userInfo="{{userInfo}}"
    currAuthStep="{{currAuthStep}}"
    couponCount="{{couponCount}}"
    bind:gotoUserEditPage="gotoUserEditPage"
    bind:onTapPoints="onTapPoints"
    bind:onTapBalance="onTapBalance"
    bind:onTapCoupon="onTapCoupon"
  />

  <!-- 内容区域 -->
  <view class="content-wrapper">
    <!-- 我的订单 -->
    <view class="section">
      <t-order-group
        orderTagInfos="{{orderTagInfos}}"
        bind:onClickTop="jumpAllOrder"
        bind:onClickItem="jumpNav"
      />
    </view>

    <!-- 我的资产 -->
    <view class="section" wx:if="{{currAuthStep !== 1}}">
      <view class="section-card">
        <view class="section-header">
          <text class="section-title">我的资产</text>
        </view>
        <view class="assets-row">
          <view class="assets-item" bind:tap="onTapPoints">
            <view class="assets-value">{{userInfo.points || 0}}</view>
            <view class="assets-label">积分</view>
          </view>
          <view class="assets-item" bind:tap="onTapBalance">
            <view class="assets-value">{{userInfo.balance || '0.00'}}</view>
            <view class="assets-label">余额</view>
          </view>
          <view class="assets-item" bind:tap="onTapCoupon">
            <view class="assets-value assets-value--coupon">{{couponCount || 0}}<text class="assets-sup" wx:if="{{couponCount > 0}}">+</text></view>
            <view class="assets-label">优惠券</view>
          </view>
        </view>
      </view>
    </view>

    <!-- 服务与工具 -->
    <view class="section">
      <view class="section-card">
        <view class="section-header">
          <text class="section-title">服务与工具</text>
        </view>
        <view class="tools-grid">
          <view
            class="tools-item"
            wx:for="{{toolsData}}"
            wx:key="type"
            data-type="{{item.type}}"
            bind:tap="onClickCell"
          >
            <view class="tools-icon tools-icon--{{item.type}}">
              <t-icon name="{{item.iconName}}" size="44rpx" color="#fff" />
            </view>
            <text class="tools-item-title">{{item.title}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <view class="footer__version" wx:if="{{versionNo !== ''}}">当前版本 {{versionNo}}</view>
</view>

<!-- 客服弹窗 -->
<t-popup visible="{{showMakePhone}}" placement="bottom" bind:visible-change="closeMakePhone">
  <view class="popup-content">
    <view class="popup-title" wx:if="{{customerServiceInfo.serviceTimeDuration}}">
      服务时间: {{customerServiceInfo.serviceTimeDuration}}
    </view>
    <view class="popup-phone" bind:tap="call">电话客服</view>
    <button class="popup-phone popup-phone--online" open-type="contact" wx:if="{{showKefu}}">在线客服</button>
    <view class="popup-close" bind:tap="closeMakePhone">取消</view>
  </view>
</t-popup>
<t-toast id="t-toast" />
